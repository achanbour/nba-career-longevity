---
title: "ST310 coursework - NBA Career Longevity"
author: "Anastasia, Ayo and Suneet"
date: "January 2022"
output: html_document
# output: # uncomment before handing in
#   html_document:
#     toc: true
#     toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(kableExtra)
#library(dplyr) # included in tidyverse
library(tree)
```

# Introduction
What we are trying to achieve

### Read in data and display the first 5 rows

```{r}
data_in <- read.csv("data_in/nba_logreg.csv")

kable(data_in[1:5,]) %>%
  kable_styling(bootstrap_options = c("striped", "bordered", "hover", "condensed", "responsive")) %>%
  scroll_box(width = "800px")

```

### Data dictionary and description of key variables

```{r}
data_dict <- read.csv("data_in/data_dictionary.csv")

kable(data_dict) %>%
kable_styling(bootstrap_options = c("striped", "bordered", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "300px")

```

# Data preparation

### Create indicator variables

```{r}

```

# Analysis

### Comparing means of successful and unsuccessful players for each predictor variable

To get a sense of which predictors are likely to be most useful, for each predictor, we compare the mean values of players who went on to be successful (TARGET_5Yrs = 1) and those who did not (TARGET_5Yrs = 0)


```{r} 
all_vars <- data_in %>%
  select(-Name, -Round_Drafted, -Team, -Position, -Win_Perc, -X3P.) %>% 
  pivot_longer(!TARGET_5Yrs, names_to = "variable", values_to = "value") %>% 
  group_by(TARGET_5Yrs, variable) %>% 
  summarise(mean = mean(value)) %>% 
  group_by(variable) %>% 
  pivot_wider(names_from = TARGET_5Yrs, values_from = mean) %>% 
  ungroup() %>% 
  rename("under_five_years" = "0", "over_five_years" = "1") %>% 
  mutate(percent_diff = 100*(over_five_years/under_five_years - 1)) %>% 
  mutate_if(is.numeric, ~round(., 2)) %>% 
  arrange(-percent_diff)

kable(all_vars) %>%
kable_styling(bootstrap_options = c("striped", "bordered", "hover", "condensed", "responsive")) %>%
  scroll_box(height = "300px")

```

### Baseline model - a single tree classifier based on few predictors

```{r}
#only interested to classify by GP, PTS, REB, Win_Perc
features <- as.vector(c("GP", "PTS", "REB", "Win_Perc", "TARGET_5Yrs"))
tree_data <- data_in[ ,features]

fit_tree <- tree(TARGET_5Yrs ~ .,
                 data = tree_data)

plot(fit_tree, type = "uniform")
text(fit_tree, pretty = 0, cex = 1.1)

```
